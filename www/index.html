
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="icon" href="/favicon.png" type="image/png">
  <meta name="theme-color" content="#88af25">
  <link rel="manifest" href="/manifest.webmanifest?v=2">
  <meta name="viewport" content="width=device-width">
  <title>Gardenr</title>
  <meta name="Description" content="An indoor gardening assistant">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
  <style>
    body {
      font-family: 'Roboto Mono', monospace;
      background-color: #d9e0e7;
    }
    .measure {
      margin: 10px 0;
      padding-left: 10px;
      border-left: 5px solid #88af25;
    }
  </style>
</head>
<body>
  <noscript>JavaScript is disabled!</noscript>
  <h4>Gardenr</h4>
  <div class="measure">Updated: <span id="updated">N/A</span></div>
  <div class="measure">Moisture: <span id="moisture">N/A</span></div>
  <div class="measure">Temperature: <span id="tempurature">N/A</span></div>
  <div class="measure">Humidity: <span id="humidity">N/A</span></div>
  <script>
    function humanDate(date) {
      date = new Date(date);
      return date.getFullYear() +
            '-' + ('0' + date.getMonth() + 1).slice(-2) +
            '-' + ('0' + date.getDate()).slice(-2) +
            ' '  + ('0' + date.getHours()).slice(-2) +
            ':' + ('0' + date.getMinutes()).slice(-2) +
            ':' + ('0' + date.getSeconds()).slice(-2);
    }

    (function getData() {
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.open('GET', '/data.json', true);
      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4) {
          if(xmlhttp.status == 200) {
            var obj = JSON.parse(xmlhttp.responseText);
            document.getElementById('updated').innerHTML = humanDate(obj.updated * 1000);
            document.getElementById('moisture').innerHTML = obj.moisture;
            document.getElementById('tempurature').innerHTML = Math.round(obj.temperature * 100) / 100;
            document.getElementById('humidity').innerHTML = obj.humidity;
          }
        }
      }
      xmlhttp.send(null);
      setTimeout(getData, 10000);
    })();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
      .then((registration) => {
        console.log('[SW] Service worker is all cool.');
      }).catch(function(e) {
        console.error('[SW] Service worker is not so cool.', e);
        throw e;
      });
    }
  </script>
</body>
</html>
